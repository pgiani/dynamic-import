{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/pgiani/www/meteor-example-optimize-client-bundle/packages/dburles:factory/factory.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/dburles:factory/factory.js","filename":"/Users/pgiani/www/meteor-example-optimize-client-bundle/packages/dburles:factory/factory.js","passPerPreset":false,"envName":"development","cwd":"/Users/pgiani/www/meteor-example-optimize-client-bundle","root":"/Users/pgiani/www/meteor-example-optimize-client-bundle","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/pgiani/www/meteor-example-optimize-client-bundle/packages/dburles:factory/factory.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/dburles:factory/factory.js"}},"code":"/* global LocalCollection */\n\n/* global Factory:true */\nvar factories = {};\n\nFactory =\n/*#__PURE__*/\nfunction () {\n  function Factory(name, collection, attributes) {\n    this.name = name;\n    this.collection = collection;\n    this.attributes = attributes;\n    this.afterHooks = [];\n    this.sequence = 0;\n  }\n\n  var _proto = Factory.prototype;\n\n  _proto.after = function () {\n    function after(fn) {\n      this.afterHooks.push(fn);\n      return this;\n    }\n\n    return after;\n  }();\n\n  return Factory;\n}();\n\nFactory.define = function (name, collection, attributes) {\n  factories[name] = new Factory(name, collection, attributes);\n  return factories[name];\n};\n\nFactory.get = function (name) {\n  var factory = factories[name];\n\n  if (!factory) {\n    throw new Error(\"Factory: There is no factory named \" + name);\n  }\n\n  return factory;\n};\n\nFactory._build = function (name) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  var factory = Factory.get(name);\n  var result = {}; // \"raw\" attributes without functions evaluated, or dotted properties resolved\n\n  var extendedAttributes = _.extend({}, factory.attributes, attributes); // either create a new factory and return its _id\n  // or return a 'fake' _id (since we're not inserting anything)\n\n\n  var makeRelation = function (relName) {\n    if (options.insert) {\n      return Factory.create(relName, {}, userOptions)._id;\n    }\n\n    if (options.tree) {\n      return Factory._build(relName, {}, userOptions, {\n        tree: true\n      });\n    } // fake an id on build\n\n\n    return Random.id();\n  };\n\n  var getValue = function (value) {\n    return value instanceof Factory ? makeRelation(value.name) : value;\n  };\n\n  var getValueFromFunction = function (func) {\n    var api = {\n      sequence: function (fn) {\n        return fn(factory.sequence);\n      }\n    };\n    var fnRes = func.call(result, api, userOptions);\n    return getValue(fnRes);\n  };\n\n  factory.sequence += 1;\n\n  var walk = function (record, object) {\n    _.each(object, function (value, key) {\n      var newValue = value; // is this a Factory instance?\n\n      if (value instanceof Factory) {\n        newValue = makeRelation(value.name);\n      } else if (_.isArray(value)) {\n        newValue = value.map(function (element) {\n          if (_.isFunction(element)) {\n            return getValueFromFunction(element);\n          }\n\n          return getValue(element);\n        });\n      } else if (_.isFunction(value)) {\n        newValue = getValueFromFunction(value); // if an object literal is passed in, traverse deeper into it\n      } else if (Object.prototype.toString.call(value) === '[object Object]') {\n        record[key] = record[key] || {};\n        return walk(record[key], value);\n      }\n\n      var modifier = {\n        $set: {}\n      };\n\n      if (key !== '_id') {\n        modifier.$set[key] = newValue;\n      }\n\n      LocalCollection._modify(record, modifier);\n    });\n  };\n\n  walk(result, extendedAttributes);\n\n  if (!options.tree) {\n    result._id = extendedAttributes._id || Random.id();\n  }\n\n  return result;\n};\n\nFactory.build = function (name) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return Factory._build(name, attributes, userOptions);\n};\n\nFactory.tree = function (name, attributes) {\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return Factory._build(name, attributes, userOptions, {\n    tree: true\n  });\n};\n\nFactory._create = function (name, doc) {\n  var collection = Factory.get(name).collection;\n  var insertId = collection.insert(doc);\n  var record = collection.findOne(insertId);\n  return record;\n};\n\nFactory.create = function (name) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var doc = Factory._build(name, attributes, userOptions, {\n    insert: true\n  });\n\n  var record = Factory._create(name, doc);\n\n  Factory.get(name).afterHooks.forEach(function (cb) {\n    return cb(record);\n  });\n  return record;\n};\n\nFactory.extend = function (name) {\n  var attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return _.extend(_.clone(Factory.get(name).attributes), attributes);\n};","map":{"version":3,"sources":["packages/dburles:factory/factory.js"],"names":["factories","Factory","name","collection","attributes","afterHooks","sequence","after","fn","push","define","get","factory","Error","_build","userOptions","options","result","extendedAttributes","_","extend","makeRelation","relName","insert","create","_id","tree","Random","id","getValue","value","getValueFromFunction","func","api","fnRes","call","walk","record","object","each","key","newValue","isArray","map","element","isFunction","Object","prototype","toString","modifier","$set","LocalCollection","_modify","build","_create","doc","insertId","findOne","forEach","cb","clone"],"mappings":"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","sourcesContent":["/* global LocalCollection */\n/* global Factory:true */\n\nconst factories = {};\n\nFactory = class Factory {\n  constructor(name, collection, attributes) {\n    this.name = name;\n    this.collection = collection;\n    this.attributes = attributes;\n    this.afterHooks = [];\n    this.sequence = 0;\n  }\n\n  after(fn) {\n    this.afterHooks.push(fn);\n    return this;\n  }\n};\n\nFactory.define = (name, collection, attributes) => {\n  factories[name] = new Factory(name, collection, attributes);\n  return factories[name];\n};\n\nFactory.get = name => {\n  const factory = factories[name];\n  if (! factory) {\n    throw new Error(\"Factory: There is no factory named \" + name);\n  }\n  return factory;\n};\n\nFactory._build = (name, attributes = {}, userOptions = {}, options = {}) => {\n  const factory = Factory.get(name);\n  const result = {};\n\n  // \"raw\" attributes without functions evaluated, or dotted properties resolved\n  const extendedAttributes = _.extend({}, factory.attributes, attributes);\n\n  // either create a new factory and return its _id\n  // or return a 'fake' _id (since we're not inserting anything)\n  const makeRelation = relName => {\n    if (options.insert) {\n      return Factory.create(relName, {}, userOptions)._id;\n    }\n    if (options.tree) {\n      return Factory._build(relName, {}, userOptions, {tree: true});\n    }\n    // fake an id on build\n    return Random.id();\n  };\n\n  const getValue = value => {\n    return (value instanceof Factory) ? makeRelation(value.name) : value;\n  };\n\n  const getValueFromFunction = func => {\n    const api = { sequence: fn => fn(factory.sequence) };\n    const fnRes = func.call(result, api, userOptions);\n    return getValue(fnRes);\n  };\n\n  factory.sequence += 1;\n\n  const walk = (record, object) => {\n    _.each(object, (value, key) => {\n      let newValue = value;\n      // is this a Factory instance?\n      if (value instanceof Factory) {\n        newValue = makeRelation(value.name);\n      } else if (_.isArray(value)) {\n        newValue = value.map(element => {\n          if (_.isFunction(element)) {\n            return getValueFromFunction(element);\n          }\n          return getValue(element);\n        });\n      } else if (_.isFunction(value)) {\n        newValue = getValueFromFunction(value);\n      // if an object literal is passed in, traverse deeper into it\n      } else if (Object.prototype.toString.call(value) === '[object Object]') {\n        record[key] = record[key] || {};\n        return walk(record[key], value);\n      }\n\n      const modifier = {$set: {}};\n\n      if (key !== '_id') {\n        modifier.$set[key] = newValue;\n      }\n\n      LocalCollection._modify(record, modifier);\n    });\n  };\n\n  walk(result, extendedAttributes);\n\n  if (! options.tree) {\n    result._id = extendedAttributes._id || Random.id();\n  }\n  return result;\n};\n\nFactory.build = (name, attributes = {}, userOptions = {}) => {\n  return Factory._build(name, attributes, userOptions);\n};\n\nFactory.tree = (name, attributes, userOptions = {}) => {\n  return Factory._build(name, attributes, userOptions, {tree: true});\n};\n\nFactory._create = (name, doc) => {\n  const collection = Factory.get(name).collection;\n  const insertId = collection.insert(doc);\n  const record = collection.findOne(insertId);\n  return record;\n};\n\nFactory.create = (name, attributes = {}, userOptions = {}) => {\n  const doc = Factory._build(name, attributes, userOptions, {insert: true});\n  const record = Factory._create(name, doc);\n\n  Factory.get(name).afterHooks.forEach(cb => cb(record));\n\n  return record;\n};\n\nFactory.extend = (name, attributes = {}) => {\n  return _.extend(_.clone(Factory.get(name).attributes), attributes);\n};\n"]},"sourceType":"script","hash":"d856471574e1eee75d69df0611dbbad9172093e2"}
